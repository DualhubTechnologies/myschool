
  {% extends "partials/base.html" %}
{% load static %}
{% load widget_tweaks %}
{% block title %}Student Records - Apps{% endblock %}

{% block extra_head %}
<!-- Include additional CSS or JS if needed -->
{% endblock %}                  

{% block layout %}
<div id="filter" class="container-xxxl " style="background-color: rgb(255, 255, 255);">
  <form method="get"  id="filterForm">
    <div class="row justify-content-between">
      <div class="col-md-2 mb-3">
        <select name="school_class" class="form-control shadow-sm py-2">
          <option value="all">All Classes</option>
          {% for school_class in school_classes %}
          <option value="{{ school_class.name }}" {% if request.GET.school_class == school_class.name %}selected{% endif %}>
            {{ school_class.name }}
          </option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-2 mb-3">
        <select name="stream" class="form-control shadow-sm py-2">
          <option value="all">All Streams</option>
          {% for stream in streams %}
          <option value="{{ stream.name }}" {% if request.GET.stream == stream.name %}selected{% endif %}>
            {{ stream.name }}
          </option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-2 mb-3">
        <select name="section" class="form-control shadow-sm py-2">
          <option value="all">All Sections</option>
          <option value="boarding" {% if request.GET.section == 'boarding' %}selected{% endif %}>Boarding</option>
          <option value="day" {% if request.GET.section == 'day' %}selected{% endif %}>Day</option>
        </select>
      </div>
      <div class="col-md-2 mb-3">
        <select name="status" class="form-control shadow-sm py-2">
          <option value="all">All Status</option>
          <option value="active" {% if request.GET.status == 'active' %}selected{% endif %}>Active</option>
          <option value="suspended" {% if request.GET.status == 'suspended' %}selected{% endif %}>Suspended</option>
          <option value="expelled" {% if request.GET.status == 'expelled' %}selected{% endif %}>Expelled</option>
          <option value="deceased" {% if request.GET.status == 'deceased' %}selected{% endif %}>Deceased</option>
        </select>
      </div>
      <div class="col-md-2 mb-3 d-flex align-items-end">
        <button type="submit" class="btn btn-info w-100 py-2">Search</button>
      </div>
    </div>
  </form>
</div>


<div id="studentlist" class="card">

  <div class="d-flex align-items-center justify-content-between">
    <h3 class="card-header "><i class="fa fa-list-alt"></i>Students List</h3>
    <div>
      <a href="/students/enrollment-summary/" class="btn btn-secondary waves-effect waves-light me-4 text-white"><i
          class="ti ti-chart-pie me-1"></i><span class="d-none d-sm-inline-block">Visualize</span></a>
      <a href="/students/add/" class="btn btn-primary waves-effect waves-light me-4 text-white"><i
          class="ti ti-user-plus me-1"></i><span class="d-none d-sm-inline-block">Add Student</span></a>
    </div>
  </div>

  <!-- Filter Form -->
<!-- Filter Form -->

  <!-- DataTable, Initially Hidden (Wrapped in a div) -->
  <div class="card-datatable text-nowrap px-4" id="datatable-container" style="display:none;">
    <div class="table-responsive" style="overflow-y: auto;">
      <table id="schltb" class="table table-striped table-bordered dt-responsive nowrap" width="100%" cellspacing="0">
        <thead>
          <tr>
            <th></th>
            <th>Photo</th>
            <th>Name</th>
            <th>Schoolpay Code</th>
            <th>Gender</th>
            <th>Class</th>
            <th>Guardian/Parent</th>

            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for student in students %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td>
              {% if student.photo %}
              <img src="{{ student.photo.url }}" alt="Student Photo" width="50" height="50">
              {% else %}
              <img src="{% static 'default_student_photo.png' %}" alt="Default Photo" width="50" height="50">
              {% endif %}
            </td>
            <td>{{ student.first_name }} {{ student.other_names }} <br>
              <span style="font-size: 12px; font-weight: bold; color: #333;">{{ student.admission_number }}</span>
            </td>
            <td>{{ student.schoolpay_code }}</td>
            <td>{{ student.gender }}</td>
            <td>{{ student.school_class.name }} {{ student.stream.name }}</td>
            <td>{{ student.parent_name }} {{ student.parent_contact }}</td>
         
            <td>
              {% if student.status == 'active' %}
              <span class="badge bg-success">{{ student.get_status_display }}</span>
              {% elif student.status == 'suspended' %}
              <span class="badge bg-warning text-dark">{{ student.get_status_display }}</span>
              {% elif student.status == 'expelled' %}
              <span class="badge bg-danger">{{ student.get_status_display }}</span>
              {% elif student.status == 'deceased' %}
              <span class="badge bg-dark">{{ student.get_status_display }}</span>
              {% else %}
              <span class="badge bg-secondary">{{ student.get_status_display }}</span>
              {% endif %}
            </td>
<td>
  <div class="dropdown">
    <button class="btn btn-sm btn-icon text-secondary" type="button" id="actionDropdown_{{ student.id }}"
      data-bs-toggle="dropdown" aria-expanded="false"
      aria-label="Actions for {{ student.first_name }} {{ student.last_name }}">
      <i class="ti ti-dots-vertical"></i>
    </button>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="actionDropdown_{{ student.id }}">
      
      <!-- Edit student -->
      <li>
        <a class="dropdown-item" href="{% url 'students:student_edit' student.id %}">
          <i class="ti ti-edit me-1"></i> Edit
        </a>
      </li>
      
      <!-- View Profile -->
      <li>
        <a class="dropdown-item" href="{% url 'students:student_profile' student.id %}">
          <i class="ti ti-user me-1"></i> View Profile
        </a>
      </li>
      
      <!-- Delete student -->
      <li>
        <a class="dropdown-item text-danger" href="{% url 'students:student_delete' student.id %}"
          onclick="return confirm('Are you sure you want to remove {{ student.first_name }} {{ student.last_name }}?');">
          <i class="ti ti-trash me-1"></i> Remove
        </a>
      </li>
    </ul>
  </div>
</td>

          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

{% endblock %}

  {% block extra_js %}
<script>
  // Show the datatable after search
  if (document.getElementById('schltb').rows.length > 0) {
    document.getElementById('datatable-container').style.display = 'block';
  }
</script>
<script>
  $(document).ready(function () {
    $('#schltb').DataTable({
      responsive: true,
      pageLength: 10,
      lengthChange: true,
      searching: true,
      ordering: true,
      info: true,
      paging: true
    });
  });
</script>
  {% endblock %}
